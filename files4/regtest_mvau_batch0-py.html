<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>regtest_mvau_batch0.py</title><link rel="stylesheet" type="text/css" href="../styles/main.css" /><script type="text/javascript" src="../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.1 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Regression_Test_Script_for_MVAU_Batch"></a><a name="Topic37"></a><div class="CTopic TFile LPython first">
 <div class="CTitle">Regression Test Script for MVAU Batch (regtest_mvau_batch0.py)</div>
 <div class="CBody"><p>Author(s): Syed Asad Alam <a href="#" onclick="javascript:location.href='ma\u0069'+'lto\u003a'+'syed\u002eas'+'ad\u002ealam'+'\u0040'+'tcd'+'\u002eie';return false;">syed&#46;as<span style="display: none">[xxx]</span>ad&#46;alam<span>&#64;</span>tcd<span style="display: none">[xxx]</span>&#46;ie</a></p><p>This python script runs a regression test for the MVAU batch based on a given set of parameters. It generates and runs HLS and RTL flows and compares performance of both in terms of FPGA resource utilization, timing and run time All performance numbers are written to an output excel file. This script is specific for layer 0 of a 4-layer multi-layer perceptron (MLP) network used in network intrusion detection</p><p>This material is based upon work supported, in part, by Science Foundation Ireland, www.sfi.ie under Grant No. 13/RC/2094_P2 and, in part, by the European Union's Horizon 2020 research and innovation programme under the Marie Sklodowska-Curie grant agreement Grant No.754489.&nbsp; #</p></div>
</div>

<a name="MyHanlder"></a><a name="Topic38"></a><div class="CTopic TClass LPython">
 <div class="CTitle">MyHanlder</div>
 <div class="CBody"><p>Handles unexpected termination or explicit termination by Ctrl+C by calling the write_rpt_file function to write whatever data has been extracted so far</p><div class="CHeading">Attributes</div><table class="CDefinitionList"><tr><td class="CDLEntry">rpt_dict</td><td class="CDLDefinition"><p>Dictionary containing all performance measures to be written</p></td></tr><tr><td class="CDLEntry">rpt_col_names</td><td class="CDLDefinition"><p>Column names for various meausres written to the output excel file</p></td></tr><tr><td class="CDLEntry">config_dict</td><td class="CDLDefinition"><p>Configurations for which the regression test is being run</p></td></tr><tr><td class="CDLEntry">config_col_names</td><td class="CDLDefinition"><p>Configuration parameters against which the tests are being run. Acts as column names for the output excel file</p></td></tr><tr><td class="CDLEntry">out_file</td><td class="CDLDefinition"><p>Output excel file name</p></td></tr></table></div>
</div>

<a name="MyHanlder.Functions"></a><a name="Topic39"></a><div class="CTopic TGroup LPython">
 <div class="CTitle">Functions</div>
</div>

<a name="MyHanlder.__init__"></a><a name="Topic40"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">__init__</div>
 <div id="NDPrototype40" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> __init__(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">self,</td></tr><tr><td class="PName first last">rpt_dict,</td></tr><tr><td class="PName first last">rpt_col_names,</td></tr><tr><td class="PName first last">config_dict,</td></tr><tr><td class="PName first last">config_col_names,</td></tr><tr><td class="PName first last">out_file</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>The construction initializes the attributes with corresponding input parameters</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">rpt_dict</td><td class="CDLDefinition"><p>Dictionary containing all performance measures to be written</p></td></tr><tr><td class="CDLEntry">rpt_col_names</td><td class="CDLDefinition"><p>Column names for various meausres written to the output excel file</p></td></tr><tr><td class="CDLEntry">config_dict</td><td class="CDLDefinition"><p>Configurations for which the regression test is being run</p></td></tr><tr><td class="CDLEntry">config_col_names</td><td class="CDLDefinition"><p>Configuration parameters against which the tests are being run. Acts as column names for the output excel file</p></td></tr><tr><td class="CDLEntry">out_file</td><td class="CDLDefinition"><p>Output excel file name</p></td></tr></table></div>
</div>

<a name="MyHanlder.__call__"></a><a name="Topic41"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">__call__</div>
 <div id="NDPrototype41" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> __call__(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">self,</td></tr><tr><td class="PName first last">signo,</td></tr><tr><td class="PName first last">frame</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This method is called when the unexpected termination takes place and calls the write_rpt_file function to dump all extracted data to an output file</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">signo</td><td class="CDLDefinition"><p>Number of the signal to be trapped, in this case Ctrl+C</p></td></tr><tr><td class="CDLEntry">frame</td><td class="CDLDefinition"><p>Current stack frame</p></td></tr></table></div>
</div>

<a name="MyHanlder.write_rpt_file"></a><a name="Topic42"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">write_rpt_file</div>
 <div id="NDPrototype42" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> write_rpt_file(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">rpt_dict,</td></tr><tr><td class="PName first last">rpt_col_names,</td></tr><tr><td class="PName first last">config_dict,</td></tr><tr><td class="PName first last">config_col_names,</td></tr><tr><td class="PName first last">out_file</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function takes in the performance numbers as dictionary along with configurations as a dictionariy and writes to an excel file</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">rpt_dict</td><td class="CDLDefinition"><p>Dictionary of performance numbers in terms of LUT, DSP etc.</p></td></tr><tr><td class="CDLEntry">rpt_col_names</td><td class="CDLDefinition"><p>Column Names for the excel file when writing the output performance numbers</p></td></tr><tr><td class="CDLEntry">config_dict</td><td class="CDLDefinition"><p>Dictionary containing the configurations for which the Regression test was run</p></td></tr><tr><td class="CDLEntry">config_col_names</td><td class="CDLDefinition"><p>Column Names for the excel file when writing the configurations</p></td></tr><tr><td class="CDLEntry">out_file</td><td class="CDLDefinition"><p>Output excel file name</p></td></tr></table><div class="CHeading">Returns</div><p>None</p></div>
</div>

<a name="MyHanlder.extract_hls_data"></a><a name="Topic43"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_hls_data</div>
 <div id="NDPrototype43" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_hls_data(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">log_file,</td></tr><tr><td class="PName first last">param</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function extracts performance data from HLS simulation and synthesis</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about HLS performance measures</p></td></tr><tr><td class="CDLEntry">param</td><td class="CDLDefinition"><p>The parameters against which performance numbers are to be extracted</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">block</td><td class="CDLDefinition"><p>A list of performance measures</p></td></tr><tr><td class="CDLEntry">tp</td><td class="CDLDefinition"><p>Clock period achieved by HLS</p></td></tr></table></div>
</div>

<a name="MyHanlder.extract_rtl_block_data"></a><a name="Topic44"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_rtl_block_data</div>
 <div id="NDPrototype44" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_rtl_block_data(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">log_file,</td></tr><tr><td class="PName first last">param</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function extracts performance data from RTL simulation and synthesis</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about RTL performance measures</p></td></tr><tr><td class="CDLEntry">param</td><td class="CDLDefinition"><p>The parameters against which performance numbers are to be extracted</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">block</td><td class="CDLDefinition"><p>A list of performance measures for RTL</p></td></tr></table></div>
</div>

<a name="MyHanlder.extract_rtl_timing_data"></a><a name="Topic45"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_rtl_timing_data</div>
 <div id="NDPrototype45" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_rtl_timing_data(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">log_file,</td></tr><tr><td class="PName first last">clk_per</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function extracts timing information for RTL synthesis</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about RTL timing</p></td></tr><tr><td class="CDLEntry">clk_per</td><td class="CDLDefinition"><p>The clock period constraint for synthesis</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">tim_data</td><td class="CDLDefinition"><p>Timing achieved by RTL synthesis</p></td></tr></table></div>
</div>

<a name="MyHanlder.extract_hls_latency"></a><a name="Topic46"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_hls_latency</div>
 <div id="NDPrototype46" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_hls_latency(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">log_file</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function extracts the latency of an HLS simulation</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about HLS latency</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">hls_lat</td><td class="CDLDefinition"><p>HLS latency</p></td></tr></table></div>
</div>

<a name="MyHanlder.extract_rtl_latency"></a><a name="Topic47"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_rtl_latency</div>
 <div id="NDPrototype47" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_rtl_latency(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">log_file</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function extracts the latency of an RTL simulation</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about RTL latency</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">rtl_lat</td><td class="CDLDefinition"><p>RTL latency</p></td></tr></table></div>
</div>

<a name="MyHanlder.extract_rtl_exec"></a><a name="Topic48"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_rtl_exec</div>
 <div id="NDPrototype48" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_rtl_exec(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">log_file</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function extracts the total execution time of HLS simulation and synthesis</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about HLS execution time</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">hls_exec</td><td class="CDLDefinition"><p>HLS execution time</p></td></tr></table></div>
</div>

<a name="MyHanlder.extract_rtl_exec(2)"></a><a name="Topic49"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_rtl_exec</div>
 <div class="CBody"><p>This function extracts the total execution time of RTL simulation and synthesis</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about RTL execution time</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">rtl_exec</td><td class="CDLDefinition"><p>RTL execution time</p></td></tr></table></div>
</div>

<a name="MyHanlder.calc_savings"></a><a name="Topic50"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">calc_savings</div>
 <div id="NDPrototype50" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> calc_savings(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">hls_lst,</td></tr><tr><td class="PName first last">rtl_lst</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function calculates the difference between RTL and HLS performance measures</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about HLS execution time</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">sv_list</td><td class="CDLDefinition"><p>A list of difference expressed as a percentage</p></td></tr></table></div>
</div>

<a name="MyHanlder.extract_data"></a><a name="Topic51"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_data</div>
 <div id="NDPrototype51" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_data(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">hls_run,</td></tr><tr><td class="PName first last">rtl_run,</td></tr><tr><td class="PName first last">clk_per,</td></tr><tr><td class="PName first last">finn_tb,</td></tr><tr><td class="PName first last">mvau_env</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function calls all of the above extraction function and combines them in one place for further processing. It defines all the paths where the various log files are present and defines the parameter against which the performance numbers are to be extracted</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">hls_run</td><td class="CDLDefinition"><p>Directory from where HLS reports are to be read</p></td></tr><tr><td class="CDLEntry">rtl_run</td><td class="CDLDefinition"><p>Directory from where RTL reports are to be read</p></td></tr><tr><td class="CDLEntry">clk_per</td><td class="CDLDefinition"><p>Clock constraint for synthesis</p></td></tr><tr><td class="CDLEntry">finn_tb</td><td class="CDLDefinition"><p>The path to FINN HLS library</p></td></tr><tr><td class="CDLEntry">mvau_env</td><td class="CDLDefinition"><p>The path to RTL directory</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">pd_list</td><td class="CDLDefinition"><p>A list which is a combination of HLS and RTL performance measures and the differences between them</p></td></tr></table></div>
</div>

<a name="MyHanlder.main"></a><a name="Topic52"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">main</div>
 <div id="NDPrototype52" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> main(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">kdim_arr,</td></tr><tr><td class="PName first last">ifm_ch_arr,</td></tr><tr><td class="PName first last">ofm_ch_arr,</td></tr><tr><td class="PName first last">ifm_dim_arr,</td></tr><tr><td class="PName first last">inp_wl_arr,</td></tr><tr><td class="PName first last">inp_wl_sgn,</td></tr><tr><td class="PName first last">wgt_wl_arr,</td></tr><tr><td class="PName first last">wgt_wl_sgn,</td></tr><tr><td class="PName first last">simd,</td></tr><tr><td class="PName first last">pe,</td></tr><tr><td class="PName first last">finn_tb,</td></tr><tr><td class="PName first last">mvau_env,</td></tr><tr><td class="PName first last">mvau_tb,</td></tr><tr><td class="PName first last">out_file</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>The main top level function which defines the parameters to be evaluated, configures the column names for the Excel output file, handles unexpected events, and runs the regression tests for various configuration parameters. After running HLS and RTL tests, it calls the extract_data function to do the main data extraction and then calls a function to write to the output Excel file</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">kdim_arr</td><td class="CDLDefinition"><p>An array containing specifications about kernel dimensions</p></td></tr><tr><td class="CDLEntry">ifm_ch_arr</td><td class="CDLDefinition"><p>An array containing specifications about input feature map size</p></td></tr><tr><td class="CDLEntry">ofm_ch_arr</td><td class="CDLDefinition"><p>An array containing specifications about output feature map size</p></td></tr><tr><td class="CDLEntry">ifm_dim_arr</td><td class="CDLDefinition"><p>An array containing specifications about input feature map dimension</p></td></tr><tr><td class="CDLEntry">inp_wl_arr</td><td class="CDLDefinition"><p>An array containing specification about input word length</p></td></tr><tr><td class="CDLEntry">inp_wl_sgn</td><td class="CDLDefinition"><p>An array containing specification about input vector sign, corresponds to inp_wl_arr</p></td></tr><tr><td class="CDLEntry">wgt_wl_arr</td><td class="CDLDefinition"><p>An array containing specification about weights precision</p></td></tr><tr><td class="CDLEntry">wgt_wl_sgn</td><td class="CDLDefinition"><p>An array containing specification about sign of weights, corresponds to wgt_wl_sgn</p></td></tr><tr><td class="CDLEntry">simd</td><td class="CDLDefinition"><p>An array containing specification about number of SIMDs</p></td></tr><tr><td class="CDLEntry">pe</td><td class="CDLDefinition"><p>An array containing specification about number of PEs</p></td></tr><tr><td class="CDLEntry">finn_tb</td><td class="CDLDefinition"><p>Directory of the FINN HLS directory</p></td></tr><tr><td class="CDLEntry">mvau_env</td><td class="CDLDefinition"><p>Directory of the MVAU RTL directory</p></td></tr><tr><td class="CDLEntry">mvau_tb</td><td class="CDLDefinition"><p>Directory of the Regression Test directory</p></td></tr><tr><td class="CDLEntry">out_file</td><td class="CDLDefinition"><p>Output excel file</p></td></tr></table></div>
</div>

<a name="MyHanlder.parser"></a><a name="Topic53"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">parser</div>
 <div id="NDPrototype53" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">def</span> parser()</div></div>
 <div class="CBody"><p>This function defines an ArgumentParser object for command line arguments</p><div class="CHeading">Returns</div><p>Parser object (parser)</p></div>
</div>

<a name="MyHanlder.__main__"></a><a name="Topic54"></a><div class="CTopic TFunction LPython last">
 <div class="CTitle">__main__</div>
 <div id="NDPrototype54" class="NDPrototype"><div class="PSection PPlainSection"><span class="SHKeyword">if</span> __name__ == <span class="SHString">'__main__'</span></div></div>
 <div class="CBody"><p>Entry point of the file, retrieves the command line argument, defines different parameters and environment variables and calls the main function to run the regression tests</p></div>
</div>

</body></html>