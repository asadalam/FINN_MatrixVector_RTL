<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>regtest_mvau.py</title><link rel="stylesheet" type="text/css" href="../styles/main.css" /><script type="text/javascript" src="../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.1 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Regression_Test_Script_for_MVAU_Batch"></a><a name="Topic1"></a><div class="CTopic TFile LPython first">
 <div class="CTitle">Regression Test Script for MVAU Batch (regtest_mvau.py)</div>
 <div class="CBody"><p>Author(s): Syed Asad Alam <a href="#" onclick="javascript:location.href='ma\u0069'+'lto\u003a'+'syed\u002eas'+'ad\u002ealam'+'\u0040'+'tcd'+'\u002eie';return false;">syed&#46;as<span style="display: none">[xxx]</span>ad&#46;alam<span>&#64;</span>tcd<span style="display: none">[xxx]</span>&#46;ie</a></p><p>This python script runs a regression test for the MVAU batch based on a given set of parameters. It generates and runs HLS and RTL flows and compares performance of both in terms of FPGA resource utilization, timing and run time All performance numbers are written to an output excel file</p><p>This material is based upon work supported, in part, by Science Foundation Ireland, www.sfi.ie under Grant No. 13/RC/2094_P2 and, in part, by the European Union's Horizon 2020 research and innovation programme under the Marie Sklodowska-Curie grant agreement Grant No.754489.&nbsp; #</p></div>
</div>

<a name="Functions"></a><a name="Topic2"></a><div class="CTopic TGroup LPython">
 <div class="CTitle">Functions</div>
</div>

<a name="write_rpt_file"></a><a name="Topic3"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">write_rpt_file</div>
 <div id="NDPrototype3" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> write_rpt_file(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">rpt_dict,</td></tr><tr><td class="PName first last">rpt_col_names,</td></tr><tr><td class="PName first last">config_dict,</td></tr><tr><td class="PName first last">config_col_names,</td></tr><tr><td class="PName first last">out_file</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function takes in the performance numbers as dictionary along with configurations as a dictionariy and writes to an excel file</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">rpt_dict</td><td class="CDLDefinition"><p>Dictionary of performance numbers in terms of LUT, DSP etc.</p></td></tr><tr><td class="CDLEntry">rpt_col_names</td><td class="CDLDefinition"><p>Column Names for the excel file when writing the output performance numbers</p></td></tr><tr><td class="CDLEntry">config_dict</td><td class="CDLDefinition"><p>Dictionary containing the configurations for which the Regression test was run</p></td></tr><tr><td class="CDLEntry">config_col_names</td><td class="CDLDefinition"><p>Column Names for the excel file when writing the configurations</p></td></tr><tr><td class="CDLEntry">out_file</td><td class="CDLDefinition"><p>Output excel file name</p></td></tr></table><div class="CHeading">Returns</div><p>None</p></div>
</div>

<a name="extract_hls_data"></a><a name="Topic4"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_hls_data</div>
 <div id="NDPrototype4" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_hls_data(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">log_file,</td></tr><tr><td class="PName first last">param</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function extracts performance data from HLS simulation and synthesis</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about HLS performance measures</p></td></tr><tr><td class="CDLEntry">param</td><td class="CDLDefinition"><p>The parameters against which performance numbers are to be extracted</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">block</td><td class="CDLDefinition"><p>A list of performance measures</p></td></tr><tr><td class="CDLEntry">tp</td><td class="CDLDefinition"><p>Clock period achieved by HLS</p></td></tr></table></div>
</div>

<a name="extract_rtl_block_data"></a><a name="Topic5"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_rtl_block_data</div>
 <div id="NDPrototype5" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_rtl_block_data(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">log_file,</td></tr><tr><td class="PName first last">param</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function extracts performance data from RTL simulation and synthesis</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about RTL performance measures</p></td></tr><tr><td class="CDLEntry">param</td><td class="CDLDefinition"><p>The parameters against which performance numbers are to be extracted</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">block</td><td class="CDLDefinition"><p>A list of performance measures for RTL</p></td></tr></table></div>
</div>

<a name="extract_rtl_timing_data"></a><a name="Topic6"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_rtl_timing_data</div>
 <div id="NDPrototype6" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_rtl_timing_data(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">log_file,</td></tr><tr><td class="PName first last">clk_per</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function extracts timing information for RTL synthesis</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about RTL timing</p></td></tr><tr><td class="CDLEntry">clk_per</td><td class="CDLDefinition"><p>The clock period constraint for synthesis</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">tim_data</td><td class="CDLDefinition"><p>Timing achieved by RTL synthesis</p></td></tr></table></div>
</div>

<a name="extract_hls_latency"></a><a name="Topic7"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_hls_latency</div>
 <div id="NDPrototype7" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_hls_latency(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">log_file</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function extracts the latency of an HLS simulation</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about HLS latency</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">hls_lat</td><td class="CDLDefinition"><p>HLS latency</p></td></tr></table></div>
</div>

<a name="extract_rtl_latency"></a><a name="Topic8"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_rtl_latency</div>
 <div id="NDPrototype8" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_rtl_latency(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">log_file</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function extracts the latency of an RTL simulation</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about RTL latency</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">rtl_lat</td><td class="CDLDefinition"><p>RTL latency</p></td></tr></table></div>
</div>

<a name="extract_rtl_exec"></a><a name="Topic9"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_rtl_exec</div>
 <div id="NDPrototype9" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_rtl_exec(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">log_file</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function extracts the total execution time of HLS simulation and synthesis</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about HLS execution time</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">hls_exec</td><td class="CDLDefinition"><p>HLS execution time</p></td></tr></table></div>
</div>

<a name="extract_rtl_exec(2)"></a><a name="Topic10"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_rtl_exec</div>
 <div class="CBody"><p>This function extracts the total execution time of RTL simulation and synthesis</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about RTL execution time</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">rtl_exec</td><td class="CDLDefinition"><p>RTL execution time</p></td></tr></table></div>
</div>

<a name="calc_savings"></a><a name="Topic11"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">calc_savings</div>
 <div id="NDPrototype11" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> calc_savings(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">hls_lst,</td></tr><tr><td class="PName first last">rtl_lst</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function calculates the difference between RTL and HLS performance measures</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">log_file</td><td class="CDLDefinition"><p>The log file which contains information about HLS execution time</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">sv_list</td><td class="CDLDefinition"><p>A list of difference expressed as a percentage</p></td></tr></table></div>
</div>

<a name="extract_data"></a><a name="Topic12"></a><div class="CTopic TFunction LPython">
 <div class="CTitle">extract_data</div>
 <div id="NDPrototype12" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> extract_data(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">hls_run,</td></tr><tr><td class="PName first last">rtl_run,</td></tr><tr><td class="PName first last">clk_per,</td></tr><tr><td class="PName first last">finn_tb,</td></tr><tr><td class="PName first last">mvau_env</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>This function calls all of the above extraction function and combines them in one place for further processing. It defines all the paths where the various log files are present and defines the parameter against which the performance numbers are to be extracted</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">hls_run</td><td class="CDLDefinition"><p>Directory from where HLS reports are to be read</p></td></tr><tr><td class="CDLEntry">rtl_run</td><td class="CDLDefinition"><p>Directory from where RTL reports are to be read</p></td></tr><tr><td class="CDLEntry">clk_per</td><td class="CDLDefinition"><p>Clock constraint for synthesis</p></td></tr><tr><td class="CDLEntry">finn_tb</td><td class="CDLDefinition"><p>The path to FINN HLS library</p></td></tr><tr><td class="CDLEntry">mvau_env</td><td class="CDLDefinition"><p>The path to RTL directory</p></td></tr></table><div class="CHeading">Returns</div><table class="CDefinitionList"><tr><td class="CDLEntry">pd_list</td><td class="CDLDefinition"><p>A list which is a combination of HLS and RTL performance measures and the differences between them</p></td></tr></table></div>
</div>

<a name="main"></a><a name="Topic13"></a><div class="CTopic TFunction LPython last">
 <div class="CTitle">main</div>
 <div id="NDPrototype13" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">def</span> main(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">kdim_arr,</td></tr><tr><td class="PName first last">ifm_ch_arr,</td></tr><tr><td class="PName first last">ofm_ch_arr,</td></tr><tr><td class="PName first last">ifm_dim_arr,</td></tr><tr><td class="PName first last">inp_wl_arr,</td></tr><tr><td class="PName first last">inp_wl_sgn,</td></tr><tr><td class="PName first last">wgt_wl_arr,</td></tr><tr><td class="PName first last">wgt_wl_sgn,</td></tr><tr><td class="PName first last">simd,</td></tr><tr><td class="PName first last">pe,</td></tr><tr><td class="PName first last">finn_tb,</td></tr><tr><td class="PName first last">mvau_env,</td></tr><tr><td class="PName first last">mvau_tb,</td></tr><tr><td class="PName first last">out_file</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>The main top level function which defines the parameters to be evaluated, configures the column names for the Excel output file, handles unexpected events, and runs the regression tests for various configuration parameters. After running HLS and RTL tests, it calls the extract_data function to do the main data extraction and then calls a function to write to the output Excel file</p><div class="CHeading">Parameters</div><p>kdim_arr - ifm_ch_arr - ofm_ch_arr - ifm_dim_arr - inp_wl_arr - inp_wl_sgn - wgt_wl_arr - wgt_wl_sgn - simd - pe - finn_tb - mvau_env - mvau_tb - out_file -</p></div>
</div>

</body></html>