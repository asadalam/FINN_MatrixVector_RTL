<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>mvau_stream_control_block.sv</title><link rel="stylesheet" type="text/css" href="../../styles/main.css" /><script type="text/javascript" src="../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.1 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Module"></a><a name="Topic340"></a><div class="CTopic TGroup LSystemVerilog first">
 <div class="CTitle">Module</div>
</div>

<a name="MVAU_Streaming_Block_Control_Unit"></a><a name="Topic341"></a><div class="CTopic TModule LSystemVerilog">
 <div class="CTitle"><span class="Qualifier">MVAU Streaming Block Control Unit (mvau_stream_control_block.</span>&#8203;sv)</div>
 <div class="CBody"><p>Author(s): Syed Asad Alam <a href="#" onclick="javascript:location.href='ma\u0069'+'lto\u003a'+'syed\u002eas'+'ad\u002ealam'+'\u0040'+'tcd'+'\u002eie';return false;">syed&#46;as<span style="display: none">[xxx]</span>ad&#46;alam<span>&#64;</span>tcd<span style="display: none">[xxx]</span>&#46;ie</a></p><p>This file lists an RTL implementation of the control block It is used to control the input buffer and generation of the correct control signals to control the multiplication operation and generate address, write and read enable for the input buffer. It also contains free running counters to track as each input activation vector is processed</p><p>It is part of the Xilinx FINN open source framework for implementing quantized neural networks on FPGAs</p><p>This material is based upon work supported, in part, by Science Foundation Ireland, www.sfi.ie under Grant No. 13/RC/2094 and, in part, by the European Union's Horizon 2020 research and innovation programme under the Marie Sklodowska-Curie grant agreement Grant No.754489.</p><div class="CHeading">Inputs</div><table class="CDefinitionList"><tr><td class="CDLEntry">aresetn</td><td class="CDLDefinition"><p>Active low synchronous reset</p></td></tr><tr><td class="CDLEntry">aclk</td><td class="CDLDefinition"><p>Main clock</p></td></tr><tr><td class="CDLEntry">in_v</td><td class="CDLDefinition"><p>Input activation stream valid</p></td></tr><tr><td class="CDLEntry">wait_rready</td><td class="CDLDefinition"><p>Signal that indicates whether rready has been asserted after valid Outputs:</p></td></tr><tr><td class="CDLEntry">ib_wen</td><td class="CDLDefinition"><p>Write enable for the input buffer</p></td></tr><tr><td class="CDLEntry">ib_red</td><td class="CDLDefinition"><p>Read enable for the input buffer</p></td></tr><tr><td class="CDLEntry">wready</td><td class="CDLDefinition"><p>Output ready signal, to indicate when the input buffer can accept new input</p></td></tr><tr><td class="CDLEntry">wmem_wready</td><td class="CDLDefinition"><p>Output ready signal for the weight memory</p></td></tr><tr><td class="CDLEntry">sf_clr</td><td class="CDLDefinition"><p>Control signal for resetting the accumulator and a one bit control signal to indicate when sf_cnt == SF-1</p></td></tr><tr><td class="CDLEntry">[SF_T:0] sf_cnt</td><td class="CDLDefinition"><p>Address for the input buffer</p></td></tr></table><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">SF=MatrixW/SIMD</td><td class="CDLDefinition"><p>Number of vertical weight matrix chunks and depth of the input buffer</p></td></tr><tr><td class="CDLEntry">NF=MatrixH/PE</td><td class="CDLDefinition"><p>Number of horizontal weight matrix chunks</p></td></tr><tr><td class="CDLEntry">SF_T</td><td class="CDLDefinition"><p>log_2(SF), determines the number of address bits for the input buffer * SF_T</p></td></tr><tr><td class="CDLEntry">NF_T</td><td class="CDLDefinition"><p>log_2(NF), word length of the NF counter to control reading and writing from the input buffer</p></td></tr></table></div>
</div>

<a name="Signals"></a><a name="Topic342"></a><div class="CTopic TGroup LSystemVerilog">
 <div class="CTitle">Signals</div>
</div>

<a name="inp_active"></a><a name="Topic343"></a><div class="CTopic TSignal LSystemVerilog">
 <div class="CTitle">inp_active</div>
 <div class="CBody"><p>Internal signal to indicate when input data is active Asserted when input valid and output ready asserted</p></div>
</div>

<a name="do_mvau_stream"></a><a name="Topic344"></a><div class="CTopic TSignal LSystemVerilog">
 <div class="CTitle">do_mvau_stream</div>
 <div class="CBody"><p>Internal signal to indicate when to perform all computations</p></div>
</div>

<a name="sf_full"></a><a name="Topic345"></a><div class="CTopic TSignal LSystemVerilog">
 <div class="CTitle">sf_full</div>
 <div class="CBody"><p>Internal signal to indicate if sf_cnt has gone full</p></div>
</div>

<a name="ap_start"></a><a name="Topic346"></a><div class="CTopic TSignal LSystemVerilog">
 <div class="CTitle">ap_start</div>
 <div class="CBody"><p>Internal signal to indicate when to start computations after reset</p></div>
</div>

<a name="halt_mvau_stream"></a><a name="Topic347"></a><div class="CTopic TSignal LSystemVerilog">
 <div class="CTitle">halt_mvau_stream</div>
 <div class="CBody"><p>Internal signal to halt the computations in case of missing input ready</p></div>
</div>

<a name="Sequential_Always_Blocks"></a><a name="Topic348"></a><div class="CTopic TGroup LSystemVerilog">
 <div class="CTitle">Sequential Always Blocks</div>
</div>

<a name="SF_CNT"></a><a name="Topic349"></a><div class="CTopic TAlwaysFF LSystemVerilog">
 <div class="CTitle">SF_CNT</div>
 <div class="CBody"><p>A sequential 'always' block for a counter which keeps track when the input buffer is full.&nbsp; Only runs when do_mvau_stream is asserted A counter similar to sf in mvau.hpp</p></div>
</div>

<a name="DLY_WAIT_READY"></a><a name="Topic350"></a><div class="CTopic TAlwaysFF LSystemVerilog">
 <div class="CTitle">DLY_WAIT_READY</div>
 <div class="CBody"><p>Delaying the wait ready signal by one clock signal If the wait_rready signal is asserted for two consecutive clock cycles, need to halt computation</p></div>
</div>

<a name="Signals(2)"></a><a name="Topic351"></a><div class="CTopic TGroup LSystemVerilog">
 <div class="CTitle">Signals</div>
</div>

<a name="State_variables"></a><a name="Topic352"></a><div class="CTopic TSignal LSystemVerilog">
 <div class="CTitle">State variables</div>
 <div class="CBody"><p>Three states: a) IDLE: When no input available or when computation is halted b) WRITE: When writing to the input buffer c) READ: When reading from the input buffer</p></div>
</div>

<a name="nf_clr"></a><a name="Topic353"></a><div class="CTopic TSignal LSystemVerilog">
 <div class="CTitle">nf_clr</div>
 <div class="CBody"><p>Signal to reset the nf_cnt counter Only used when multiple output channel</p></div>
</div>

<a name="nf_zero"></a><a name="Topic354"></a><div class="CTopic TSignal LSystemVerilog">
 <div class="CTitle">nf_zero</div>
 <div class="CBody"><p>Signal to indicate when nf_cnt equals zero</p></div>
</div>

<a name="nf_cnt"></a><a name="Topic355"></a><div class="CTopic TSignal LSystemVerilog">
 <div class="CTitle">nf_cnt</div>
 <div class="CBody"><p>A counter to keep track how many weight channels have been processed Only used when multiple output channels</p></div>
</div>

<a name="nf_full"></a><a name="Topic356"></a><div class="CTopic TSignal LSystemVerilog">
 <div class="CTitle">nf_full</div>
 <div class="CBody"><p>Signal to indicate the the nf_cnt has saturated along with sf_cnt</p></div>
</div>

<a name="Sequential_Always_Blocks(2)"></a><a name="Topic357"></a><div class="CTopic TGroup LSystemVerilog">
 <div class="CTitle">Sequential Always Blocks</div>
</div>

<a name="PRES_STATE"></a><a name="Topic358"></a><div class="CTopic TAlwaysFF LSystemVerilog">
 <div class="CTitle">PRES_STATE</div>
 <div class="CBody"><p>Always block to assign the pres_state signal</p></div>
</div>

<a name="Combinatorial_Always_Blocks"></a><a name="Topic359"></a><div class="CTopic TGroup LSystemVerilog">
 <div class="CTitle">Combinatorial Always Blocks</div>
</div>

<a name="NEXT_STATE"></a><a name="Topic360"></a><div class="CTopic TAlwaysCOMB LSystemVerilog">
 <div class="CTitle">NEXT_STATE</div>
 <div class="CBody"><p>Computing the next state</p></div>
</div>

<a name="STATE_OUT"></a><a name="Topic361"></a><div class="CTopic TAlwaysCOMB LSystemVerilog">
 <div class="CTitle">STATE_OUT</div>
 <div class="CBody"><p>Computing the outputs of the state machine</p></div>
</div>

<a name="Sequential_Always_Blocks(3)"></a><a name="Topic362"></a><div class="CTopic TGroup LSystemVerilog">
 <div class="CTitle">Sequential Always Blocks</div>
</div>

<a name="NF_CLR"></a><a name="Topic363"></a><div class="CTopic TAlwaysFF LSystemVerilog">
 <div class="CTitle">NF_CLR</div>
 <div class="CBody"><p>A one bit control signal to indicate when nf_cnt == NF</p></div>
</div>

<a name="WRDY"></a><a name="Topic364"></a><div class="CTopic TAlwaysFF LSystemVerilog">
 <div class="CTitle">WRDY</div>
 <div class="CBody"><p>Remains one when the input buffer is being filled Resets to Zero the input buffer is filled and ready to be reused</p></div>
</div>

<a name="NF_CNT"></a><a name="Topic365"></a><div class="CTopic TAlwaysFF LSystemVerilog">
 <div class="CTitle">NF_CNT</div>
 <div class="CBody"><p>A counter to keep track when we are done writing to the input buffer so that it can be reused again Similar to the variable nf in mvau.hpp Only used when multiple output channels</p></div>
</div>

<a name="SF_CNT(2)"></a><a name="Topic366"></a><div class="CTopic TAlwaysFF LSystemVerilog">
 <div class="CTitle">SF_CNT</div>
 <div class="CBody"><p>A sequential 'always' block for a counter which keeps track when the input buffer is full.&nbsp; Only runs when do_mvau_stream is asserted A counter similar to sf in mvau.hpp</p></div>
</div>

<a name="AP_START"></a><a name="Topic367"></a><div class="CTopic TAlwaysFF LSystemVerilog">
 <div class="CTitle">AP_START</div>
 <div class="CBody"><p>Always block for indicating when the system comes out of reset</p></div>
</div>

<a name="SF_CLR"></a><a name="Topic368"></a><div class="CTopic TAlwaysFF LSystemVerilog last">
 <div class="CTitle">SF_CLR</div>
 <div class="CBody"><p>A one bit control signal to indicate when sf_cnt == SF-1</p></div>
</div>

</body></html>